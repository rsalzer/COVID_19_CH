var cantons=["AG","AI","AR","BE","BL","BS","FR","GE","GL","GR","JU","LU","NE","NW","OW","SG","SH","SO","SZ","TG","TI","UR","VD","VS","ZG","ZH","FL"],names={CH:"Ganze Schweiz",AG:"Kanton Aargau",AI:"Kanton Appenzell Innerhoden",AR:"Kanton Appenzell Ausserhoden",BE:"Kanton Bern",BL:"Kanton Basel Land",BS:"Kanton Basel Stadt",FR:"Kanton Freiburg",GE:"Kanton Genf",GL:"Kanton Glarus",GR:"Kanton Graubünden",JU:"Kanton Jura",LU:"Kanton Luzern",NE:"Kanton Neuenburg",NW:"Kanton Nidwalden",OW:"Kanton Obwalden",SG:"Kanton St. Gallen",SH:"Kanton Schaffhausen",SO:"Kanton Solothurn",SZ:"Kanton Schwyz",TG:"Kanton Thurgau",TI:"Kanton Tessin",UR:"Kanton Uri",VD:"Kanton Waadt",VS:"Kanton Wallis",ZG:"Kanton Zug",ZH:"Kanton Zürich",FL:"Fürstentum Liechtenstein"},actualData=[],actualDeaths=[],actualHospitalisation=[],data=[];function getCanton(e){var t="https://raw.githubusercontent.com/openZH/covid_19/master/fallzahlen_kanton_total_csv/COVID19_Fallzahlen_Kanton_"+cantons[e]+"_total.csv";"FL"==cantons[e]&&(t="https://raw.githubusercontent.com/openZH/covid_19/master/fallzahlen_kanton_total_csv/COVID19_Fallzahlen_FL_total.csv"),d3.csv(t,(function(t,n){if(null!=t)console.log(t.responseURL+" not found"),actualData.push({date:"Keine Daten",ncumul_conf:"",abbreviation_canton_and_fl:cantons[e]}),actualDeaths.push({date:"Keine Daten",ncumul_deceased:"",abbreviation_canton_and_fl:cantons[e]});else{for(var a=0;a<n.length;a++)data.push(n[a]);var d=n[n.length-1],l=n.filter((function(e){if(""!=e.ncumul_deceased)return e}));0==l.length?actualDeaths.push(d):actualDeaths.push(l[l.length-1]);var o=n.filter((function(e){if(""!=e.ncumul_hosp)return e}));0==o.length||actualHospitalisation.push(o[o.length-1]),d.ncumul_conf?actualData.push(d):n.length>1&&n[n.length-2].ncumul_conf?actualData.push(n[n.length-2]):actualData.push(d),console.log("added "+n.length+" rows for "+cantons[e])}e<cantons.length-1?getCanton(e+1):processData()}))}function processData(){document.getElementById("loadingspinner").style.display="none",console.log("Plotting data"),processActualData(),processActualDeaths(),processActualHospitalisation();for(var e=0;e<cantons.length;e++)barChartCases(cantons[e])}function processActualData(){var e=document.createElement("h3"),t=document.createTextNode("Aktueller Stand der positiv getesteten Fälle gemäss Daten der Kantone");e.appendChild(t),document.getElementById("last").append(e);var n=Array.from(actualData).sort((function(e,t){return t.ncumul_conf-e.ncumul_conf})),a="<tr><th>Kanton</th><th>Datum</th><th># Fälle</th></tr>",d=document.createElement("table");d.innerHTML=a,d.id="firstTable";var l=document.createElement("table");l.id="secondTable",l.innerHTML=a;for(var o=0,c=0;c<n.length;c++){var r;r=c<n.length/2?d:l;var i=n[c],u=i.ncumul_conf;"FL"!=i.abreviation_canton_and_fl&&""!=u&&(o+=parseInt(u));var p=document.createElement("img");p.height=15,p.src="wappen/"+i.abbreviation_canton_and_fl+".png";var s=document.createElement("tr"),m=document.createElement("td");m.appendChild(p);var h=document.createElement("a");h.href="#div_"+i.abbreviation_canton_and_fl,h.appendChild(document.createTextNode(" "+i.abbreviation_canton_and_fl+":")),m.appendChild(h),s.appendChild(m),(m=document.createElement("td")).appendChild(document.createTextNode(i.date)),s.appendChild(m),m=document.createElement("td");t=document.createTextNode(u);m.appendChild(t),s.appendChild(m),(m=document.createElement("td")).style["font-size"]="small","ht"==i.source.substring(0,2)?((h=document.createElement("a")).href=i.source,h.appendChild(document.createTextNode("(Quelle)")),m.appendChild(h)):((h=document.createElement("a")).href="https://github.com/openZH/covid_19/blob/master/fallzahlen_kanton_total_csv/COVID19_Fallzahlen_Kanton_"+i.abbreviation_canton_and_fl+"_total.csv",h.appendChild(document.createTextNode("(Quelle)")),m.appendChild(h)),s.appendChild(m),r.appendChild(s)}(s=document.createElement("tr")).id="latestrow",s.innerHTML="<td><img src='wappen/CH.png' height=15/> CH</td><td>TOTAL</td><td>"+o+"</td>",l.append(s),document.getElementById("last").append(d),document.getElementById("last").append(l)}function processActualDeaths(){var e=document.createElement("h3"),t=document.createTextNode("Verstorbene gemäss Daten der Kantone");e.appendChild(t),document.getElementById("last").append(e);var n=Array.from(actualDeaths).sort((function(e,t){return t.ncumul_deceased-e.ncumul_deceased})),a="<tr><th>Kanton</th><th>Datum</th><th># Fälle</th></tr>",d=document.createElement("table");d.innerHTML=a,d.id="firstTable";var l=document.createElement("table");l.id="secondTable",l.innerHTML=a;for(var o=0,c=0;c<n.length;c++){var r;r=c<n.length/2?d:l;var i=n[c],u=i.ncumul_deceased;"FL"!=i.abreviation_canton_and_fl&&""!=u&&(o+=parseInt(u));var p=document.createElement("img");p.height=15,p.src="wappen/"+i.abbreviation_canton_and_fl+".png";var s=document.createElement("tr"),m=document.createElement("td");m.appendChild(p);var h=document.createElement("a");h.href="#div_"+i.abbreviation_canton_and_fl,h.appendChild(document.createTextNode(" "+i.abbreviation_canton_and_fl+":")),m.appendChild(h),s.appendChild(m),(m=document.createElement("td")).appendChild(document.createTextNode(i.date)),s.appendChild(m),m=document.createElement("td");t=document.createTextNode(u);m.appendChild(t),s.appendChild(m),(m=document.createElement("td")).style["font-size"]="small","ht"==i.source.substring(0,2)?((h=document.createElement("a")).href=i.source,h.appendChild(document.createTextNode("(Quelle)")),m.appendChild(h)):((h=document.createElement("a")).href="https://github.com/openZH/covid_19/blob/master/fallzahlen_kanton_total_csv/COVID19_Fallzahlen_Kanton_"+i.abbreviation_canton_and_fl+"_total.csv",h.appendChild(document.createTextNode("(Quelle)")),m.appendChild(h)),s.appendChild(m),r.appendChild(s)}(s=document.createElement("tr")).id="latestrow",s.innerHTML="<td><img src='wappen/CH.png' height=15/> CH</td><td>TOTAL</td><td>"+o+"</td>",l.append(s),document.getElementById("last").append(d),document.getElementById("last").append(l)}function processActualHospitalisation(){var e=document.createElement("h3"),t=document.createTextNode("Fälle in Spitalbehandlung");e.appendChild(t),document.getElementById("last").append(e);var n=Array.from(actualHospitalisation).sort((function(e,t){return t.ncumul_hosp-e.ncumul_hosp})),a=document.createElement("table");a.id="secondTable",a.innerHTML="<tr><th>Kanton</th><th>Datum</th><th>Hospitalisiert</th><th>In Intensivbehandlung</th><th>Künstlich beatmet</th></tr>";for(var d=0,l=0,o=0,c=0;c<n.length;c++){var r;r=a;var i=n[c],u=i.ncumul_hosp;"FL"!=actualHospitalisation.abreviation_canton_and_fl&&""!=u&&(d+=parseInt(u)),"FL"!=actualHospitalisation.abreviation_canton_and_fl&&""!=i.ncumul_ICU&&(l+=parseInt(i.ncumul_ICU)),"FL"!=actualHospitalisation.abreviation_canton_and_fl&&""!=i.ncumul_vent&&(o+=parseInt(i.ncumul_vent));var p=document.createElement("img");p.height=15,p.src="wappen/"+i.abbreviation_canton_and_fl+".png";var s=document.createElement("tr"),m=document.createElement("td");m.appendChild(p);var h=document.createElement("a");h.href="#div_"+i.abbreviation_canton_and_fl,h.appendChild(document.createTextNode(" "+i.abbreviation_canton_and_fl+":")),m.appendChild(h),s.appendChild(m),(m=document.createElement("td")).appendChild(document.createTextNode(i.date)),s.appendChild(m),m=document.createElement("td");t=document.createTextNode(u);m.appendChild(t),s.appendChild(m),m=document.createElement("td"),t=document.createTextNode(i.ncumul_ICU),m.appendChild(t),s.appendChild(m),m=document.createElement("td"),t=document.createTextNode(i.ncumul_vent),m.appendChild(t),s.appendChild(m),(m=document.createElement("td")).style["font-size"]="small","ht"==i.source.substring(0,2)?((h=document.createElement("a")).href=i.source,h.appendChild(document.createTextNode("(Quelle)")),m.appendChild(h)):((h=document.createElement("a")).href="https://github.com/openZH/covid_19/blob/master/fallzahlen_kanton_total_csv/COVID19_Fallzahlen_Kanton_"+i.abbreviation_canton_and_fl+"_total.csv",h.appendChild(document.createTextNode("(Quelle)")),m.appendChild(h)),s.appendChild(m),r.appendChild(s)}(s=document.createElement("tr")).id="latestrow",s.innerHTML="<td><img src='wappen/CH.png' height=15/> CH</td><td>TOTAL</td><td>"+d+"</td><td>"+l+"</td><td>"+o+"</b></td>",a.append(s),document.getElementById("last").append(a),document.getElementById("last").append(document.createElement("p"))}function barChartCases(e){var t=data.filter((function(t){if(t.abbreviation_canton_and_fl==e)return t})),n=document.createElement("div");n.height=400,n.id="div_"+e;var a=document.createElement("h2"),d=document.createElement("img");d.width=20,d.src="wappen/"+e+".png",a.appendChild(d);var l=document.createTextNode(" "+names[e]);a.appendChild(l),n.appendChild(a);var o=document.createElement("canvas");if(0==t.length?n.appendChild(document.createTextNode("Keine Daten")):1==t.length?n.appendChild(document.createTextNode("Ein Datensatz: "+t[0].ncumul_conf+" Fälle am "+t[0].date)):(o.id=e,o.height=300,o.width=350+40*t.length,n.appendChild(o)),document.getElementById("cantons").appendChild(n),t&&!(t.length<2)){var c=t.filter((function(e){if(""!=e.ncumul_conf)return e})),r=c.map((function(e){var t=e.date.split("-"),n=parseInt(t[2]),a=parseInt(t[1])-1,d=parseInt(t[0]);return new Date(d,a,n)})),i=c.map((function(e){return e.ncumul_conf}));new Chart(o.id,{type:"line",options:{responsive:!1,legend:{display:!1},title:{display:!0,text:"Bestätigte Fälle"},scales:{xAxes:[{type:"time",time:{tooltipFormat:"D.MM.YYYY",unit:"day",displayFormats:{day:"D.MM"}}}]},plugins:{datalabels:{color:"black",font:{weight:"bold"},formatter:function(e,t){var n=t.dataIndex;if(0==n)return"";var a=t.dataset.data[n-1],d=e/a-1,l=Math.round(100*d),o=""+l;o=l>=0?"+"+o+"%":"-"+o+"%";var c=e-a;return o=c>0?"+"+c:c}}}},data:{labels:r,datasets:[{data:i,fill:!1,cubicInterpolationMode:"monotone",spanGaps:!0,borderColor:"#F15F36",backgroundColor:"#F15F36",datalabels:{align:"end",anchor:"end"}}]}})}}getCanton(0);